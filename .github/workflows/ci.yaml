name: helloworkflow

on:
  push:
    branches: [main] 

jobs:
  test-connection:
    runs-on: ubuntu-latest
    services: 
      postgres:
        image: postgres:13-alpine 
        ports: ["5432:5432"] 
        env:
          POSTGRES_USER: testuser
          POSTGRES_PASSWORD: testpassword
          POSTGRES_DB: testdb

    steps:
      - name: Checkout code üõéÔ∏è
        uses: actions/checkout@v3

      - name: postgres start
        run: sleep 5 

      - name: install postgres
        run: sudo apt-get update && sudo apt-get install -y postgresql-client 

      - name: test postgres ‚úÖ
        run: |
          export PGPASSWORD=testpassword
          psql -h localhost -p 5432 -U testuser -d testdb -c "SELECT 1;"
        continue-on-error: false 

      - name: Display PostgreSQL service logs (if connection fails) üìú
        if: failure() 
        run: docker logs postgres